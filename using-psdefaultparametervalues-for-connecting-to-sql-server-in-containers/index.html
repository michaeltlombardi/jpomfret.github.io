<!doctype html><html lang=en-gb dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Iâ€™ve written previously about using containers for demos on my laptop, specifically for my data compression talk.Â Since I switched those demos over I havenâ€™t looked back- if itâ€™s possible to run my demos off of containers I always choose that option.
I recently presented a talk called â€˜Life Hacks: dbatools editionâ€™ which walks through 6 scenarios where you can immediately implement dbatools to quickly reap the rewards.Â The demos can all be run on containers, but I did need to get a little more complex to be able to show off dbatools migration commands."><title>Using PSDefaultParameterValues for connecting to SQL Server in containers</title><link rel=canonical href=https://jpomfret.github.io/using-psdefaultparametervalues-for-connecting-to-sql-server-in-containers/><link rel=stylesheet href=/scss/style.min.3b122f5b6a7023e613be9affad843eaceacf4a3383edd177ce41e35501998968.css><meta property="og:title" content="Using PSDefaultParameterValues for connecting to SQL Server in containers"><meta property="og:description" content="Iâ€™ve written previously about using containers for demos on my laptop, specifically for my data compression talk.Â Since I switched those demos over I havenâ€™t looked back- if itâ€™s possible to run my demos off of containers I always choose that option.
I recently presented a talk called â€˜Life Hacks: dbatools editionâ€™ which walks through 6 scenarios where you can immediately implement dbatools to quickly reap the rewards.Â The demos can all be run on containers, but I did need to get a little more complex to be able to show off dbatools migration commands."><meta property="og:url" content="https://jpomfret.github.io/using-psdefaultparametervalues-for-connecting-to-sql-server-in-containers/"><meta property="og:site_name" content="Jess Pomfret"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="containers"><meta property="article:tag" content="dbatools"><meta property="article:tag" content="powershell"><meta property="article:published_time" content="2020-05-27T00:00:00+00:00"><meta property="article:modified_time" content="2020-05-27T00:00:00+00:00"><meta name=twitter:site content="@jpomfret"><meta name=twitter:creator content="@jpomfret"><meta name=twitter:title content="Using PSDefaultParameterValues for connecting to SQL Server in containers"><meta name=twitter:description content="Iâ€™ve written previously about using containers for demos on my laptop, specifically for my data compression talk.Â Since I switched those demos over I havenâ€™t looked back- if itâ€™s possible to run my demos off of containers I always choose that option.
I recently presented a talk called â€˜Life Hacks: dbatools editionâ€™ which walks through 6 scenarios where you can immediately implement dbatools to quickly reap the rewards.Â The demos can all be run on containers, but I did need to get a little more complex to be able to show off dbatools migration commands."></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hue9d3f1fdfff07cb5f7aa0c4e4da11a16_12179_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ðŸ¦„</span></figure><div class=site-meta><h1 class=site-name><a href=/>Jess Pomfret</a></h1><h2 class=site-description>Database Engineer with a Passion for Automation</h2></div></header><ol class=menu id=main-menu><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#enter-psdefaultparametervalues>Enter PSDefaultParameterValues</a><ol><li><a href=#option-1--add--verbose-to-individual-commands>Option 1 â€“ Add <code>-Verbose</code> to individual commands</a></li><li><a href=#option-2--set-psdefaultparametervalues>Option 2 â€“ Set PSDefaultParameterValues</a></li></ol></li><li><a href=#getting-more-specific>Getting more specific</a></li><li><a href=#psdefaultparametervalues-for-connecting-to-containers>PSDefaultParameterValues for connecting to containers</a></li><li><a href=#psdefaultparametervalues-in-your-profile>PSDefaultParameterValues in your profile</a></li><li><a href=#override>Override</a></li><li><a href=#summary>Summary</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/powershell/>powershell</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/using-psdefaultparametervalues-for-connecting-to-sql-server-in-containers/>Using PSDefaultParameterValues for connecting to SQL Server in containers</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>May 27, 2020</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>Iâ€™ve written previously about using containers for demos on my laptop, specifically for my <a class=link href=https://jesspomfret.com/data-compression-containers/ target=_blank rel=noopener>data compression talk</a>.Â  Since I switched those demos over I havenâ€™t looked back- if itâ€™s possible to run my demos off of containers I always choose that option.</p><p>I recently presented a talk called â€˜Life Hacks: dbatools editionâ€™ which walks through 6 scenarios where you can immediately implement dbatools to quickly reap the rewards.Â  The demos can all be run on containers, but I did need to get a little more complex to be able to show off dbatools migration commands. To do this I used a docker compose file.</p><p>The compose file creates one instance straight from the Microsoft SQL Server 2019 image and a second one from a dockerfile that specifies the base SQL Server 2017 image, copies in the files needed to attach the AdventureWorks2017 database, and runs some SQL to get everything setup exactly as desired. Feel free to check out this <a class=link href=https://github.com/jpomfret/demos/blob/master/LifeHacks_dbatools/Docker/docker-compose.yml target=_blank rel=noopener>setup on my Github</a>.</p><p>One of the things that bothered me about running my demos on containers was that I couldnâ€™t use windows authentication. Instead I had to pass in a SQL login to connect for every command.</p><h2 id=enter-psdefaultparametervalues>Enter PSDefaultParameterValues</h2><p>I first heard about PSDefaultParameterValues from a <a class=link href=https://github.com/PSPowerHour/PSPowerHour/tree/master/materials/2018-08-21/potatoqualitee target=_blank rel=noopener>PSPowerHour session by Chrissy LeMaire</a> in 2018. After rewatching this recently, I realised she even mentioned this exact scenario. However, it took until I recently rediscovered this handy preference variable that it all clicked together.</p><p>PSDefaultParameterValues does exactly what the name suggests- it lets you specify default values for parameters. PSDefaultParameterValues can be set as a hash table of parameter names and values that will be used in your session for any function that can use it.Â  A simple example is the verbose parameter. If you wanted to turn on the <code>-Verbose</code> switch for every function you run you could add <code>-Verbose</code> to each function call, or you could set PSDefaultParameterValues.</p><h3 id=option-1--add--verbose-to-individual-commands>Option 1 â€“ Add <code>-Verbose</code> to individual commands</h3><p>Get-DbaDbBackupHistory -SqlInstance mssql1 -Verbose
Repair-DbaDbOrphanUser -SqlInstance mssql1 -Verbose</p><h3 id=option-2--set-psdefaultparametervalues>Option 2 â€“ Set PSDefaultParameterValues</h3><p>$PSDefaultParameterValues = @{ &lsquo;*:Verbose&rsquo; = $True }
Get-DbaDbBackupHistory -SqlInstance mssql1
Repair-DbaDbOrphanUser -SqlInstance mssql1</p><p>One thing to note when specifying PSDefaultParameterValues as I have above: this will overwrite any parameters you already have saved to PSDefaultParameterValues, so be careful. Another way to set <code>-Verbose</code> to true would be to use the following notation:</p><p>$PSDefaultParameterValues[&rsquo;*:Verbose&rsquo;] = $True</p><h2 id=getting-more-specific>Getting more specific</h2><p>In the above examples Iâ€™m using a wildcard (*) on the left side to specify that this parameter is for all functions. You can also focus in PSDefaultParameterValues by specifying one certain function name that the parameter value will apply to:</p><p>$PSDefaultParameterValues[&lsquo;Get-DbaDbTable:Verbose&rsquo;] = $True</p><p>You can also specify just the dbatools commands by taking advantage of their naming conventions and using:</p><p>$PSDefaultParameterValues[&rsquo;*-Dba*:Verbose&rsquo;] = $True</p><h2 id=psdefaultparametervalues-for-connecting-to-containers>PSDefaultParameterValues for connecting to containers</h2><p>As I mentioned, my use case was to avoid having to specify a credential for every function that connected to my SQL Server running in a container. To use this for dbatools I need to specify a few parameter names. Most dbatools functions take the credential for the <code>-SqlCredential</code> parameter, but for the copy commands there is both <code>-SourceSqlCredential</code> and <code>-DestinationCredential</code> that need to be specified.</p><p>First, I create a <code>PSCredential</code> that contains my username and password (note: this is for a demo environment and is insecure as the password is in plain text. If you are using this for other scenarios youâ€™ll want to protect this credential).Â </p><p>$securePassword = (&lsquo;Password1234!&rsquo; | ConvertTo-SecureString -asPlainText -Force)
$credential = New-Object System.Management.Automation.PSCredential(&lsquo;sa&rsquo;, $securePassword)</p><p>Once I have the credential I can specify all the parameters that should use that credential by default:</p><p>$PSDefaultParameterValues = @{"*:SqlCredential"=$credential
&ldquo;*:DestinationCredential&rdquo;=$credential
&ldquo;*:DestinationSqlCredential&rdquo;=$credential
&ldquo;*:SourceSqlCredential&rdquo;=$credential}</p><p>Now whenever I call a function within this session, the specified parameters will use my credential. Therefore I can run the following and itâ€™ll automatically use my saved sa login credential.</p><p>Get-DbaDatabase -SqlInstance mssql1</p><h2 id=psdefaultparametervalues-in-your-profile>PSDefaultParameterValues in your profile</h2><p>Setting PSDefaultParameterValues will only persist in the current session, however you can add the code above to your profile so that these default values are always provided.Â  If I do, whenever I open a PowerShell window I can easily connect to my containers without having to specify the credential.</p><p>One thing to note is that this might be overkill. In my situation this is my demo machine. I always use the same sa password for any containers I run, and the majority of the time Iâ€™m running commands with a <code>SqlCredential</code> parameter I want to connect to those containers.</p><h2 id=override>Override</h2><p>Even if you have set PSDefaultParameterValues in your profile you can still override that default value on any command just by specifying a new value. For example, running the following will pop up the credential request window for you to enter new credentials.</p><p>Get-DbaDatabase -SqlInstance mssql1 -SqlCredential (Get-Credential)</p><h2 id=summary>Summary</h2><p>To wrap this up, Iâ€™ve found a lot of time savings by adding PSDefaultParameterValues to my profile. I can now quickly fire up PowerShell and start running functions against my containers.Â  It also keeps my demo scripts clean and easier to read. There is no need to specify the same parameters over and over again when itâ€™s always going to be the same value.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/containers/>containers</a>
<a href=/tags/dbatools/>dbatools</a>
<a href=/tags/powershell/>powershell</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/log-ship-staged/><div class=article-image><img src=/log-ship-staged/cover.f4ab6d164035c79e896561924d558d00_hufa84d3a6e624ae2b3ca125fbcc0da73a_679878_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post Log Shipping â€“ Pre-stage database backups with dbatools" data-key=log-ship-staged data-hash="md5-9KttFkA1x56JZWGSTVWNAA=="></div><div class=article-details><h2 class=article-title>Log Shipping â€“ Pre-stage database backups with dbatools</h2></div></a></article><article><a href=/collating-index-usage-stats-across-availability-group-replicas/><div class=article-details><h2 class=article-title>Collating index usage stats across Availability Group replicas</h2></div></a></article><article><a href=/searching-stored-procedures-for-a-pattern-made-easy-with-dbatools/><div class=article-details><h2 class=article-title>Searching Stored Procedures for a pattern made easy with dbatools</h2></div></a></article><article><a href=/quickly-execute-a-folder-of-sql-scripts-against-a-sql-server/><div class=article-details><h2 class=article-title>Quickly Execute a Folder of SQL Scripts against a SQL Server</h2></div></a></article><article><a href=/troubleshooting-spn-troubles-cannot-generate-sspi-context/><div class=article-details><h2 class=article-title>Troubleshooting SPN Troubles - Cannot generate SSPI context</h2></div></a></article></div></div></aside><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2018 -
2022 Jess Pomfret</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.15.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>