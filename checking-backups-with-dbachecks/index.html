<!doctype html><html lang=en-gb dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Folks, there is something fantastic coming from the creators of dbatools!
Chrissy LeMaire (blog|twitter) and Rob Sewell (blog|twitter) just announced something big at SQLBits 2018, a new PowerShell module that combines dbatoolsÂ with Pester to ensure your environment is &amp;ldquo;as expected&amp;rdquo;. I&amp;rsquo;ve been lucky enough to get to know both Chrissy and Rob by contributing to dbatools and when they introduced me to this new module I instantly saw a lot of potential."><title>Checking backups with dbachecks</title><link rel=canonical href=https://jpomfret.github.io/checking-backups-with-dbachecks/><link rel=stylesheet href=/scss/style.min.3b122f5b6a7023e613be9affad843eaceacf4a3383edd177ce41e35501998968.css><meta property="og:title" content="Checking backups with dbachecks"><meta property="og:description" content="Folks, there is something fantastic coming from the creators of dbatools!
Chrissy LeMaire (blog|twitter) and Rob Sewell (blog|twitter) just announced something big at SQLBits 2018, a new PowerShell module that combines dbatoolsÂ with Pester to ensure your environment is &amp;ldquo;as expected&amp;rdquo;. I&amp;rsquo;ve been lucky enough to get to know both Chrissy and Rob by contributing to dbatools and when they introduced me to this new module I instantly saw a lot of potential."><meta property="og:url" content="https://jpomfret.github.io/checking-backups-with-dbachecks/"><meta property="og:site_name" content="Jess Pomfret"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="dbachecks"><meta property="article:tag" content="powershell"><meta property="article:published_time" content="2018-02-22T00:00:00+00:00"><meta property="article:modified_time" content="2018-02-22T00:00:00+00:00"><meta name=twitter:site content="@jpomfret"><meta name=twitter:creator content="@jpomfret"><meta name=twitter:title content="Checking backups with dbachecks"><meta name=twitter:description content="Folks, there is something fantastic coming from the creators of dbatools!
Chrissy LeMaire (blog|twitter) and Rob Sewell (blog|twitter) just announced something big at SQLBits 2018, a new PowerShell module that combines dbatoolsÂ with Pester to ensure your environment is &amp;ldquo;as expected&amp;rdquo;. I&amp;rsquo;ve been lucky enough to get to know both Chrissy and Rob by contributing to dbatools and when they introduced me to this new module I instantly saw a lot of potential."><script async src="https://www.googletagmanager.com/gtag/js?id=G-YL15E7BXXF"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YL15E7BXXF",{anonymize_ip:!1})}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hue9d3f1fdfff07cb5f7aa0c4e4da11a16_12179_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ðŸ¦„</span></figure><div class=site-meta><h1 class=site-name><a href=/>Jess Pomfret</a></h1><h2 class=site-description>Database Engineer with a Passion for Automation</h2></div></header><ol class=menu id=main-menu><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/dbachecks/>dbachecks</a>
<a href=/categories/powershell/>powershell</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/checking-backups-with-dbachecks/>Checking backups with dbachecks</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Feb 22, 2018</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>3 minute read</time></div></footer></div></header><section class=article-content><p>Folks, there is something fantastic coming from the creators of dbatools!</p><p>Chrissy LeMaire (<a class=link href=https://blog.netnerds.net/ target=_blank rel=noopener>blog</a>|<a class=link href=https://twitter.com/cl target=_blank rel=noopener>twitter</a>) and Rob Sewell (<a class=link href=https://sqldbawithabeard.com/ target=_blank rel=noopener>blog</a>|<a class=link href=https://twitter.com/sqldbawithbeard target=_blank rel=noopener>twitter</a>) just announced something big at SQLBits 2018, a new PowerShell module that combines <a class=link href=https://dbatools.io/ target=_blank rel=noopener>dbatools</a>Â with <a class=link href=https://github.com/pester/Pester target=_blank rel=noopener>Pester</a> to ensure your environment is &ldquo;as expected&rdquo;. I&rsquo;ve been lucky enough to get to know both Chrissy and Rob by contributing to dbatools and when they introduced me to this new module I instantly saw a lot of potential.</p><p>I&rsquo;m going to start off with just a small way to gain some value from dbachecks, ensuring your backups are completing with the frequency you expect.</p><p>The module is hosted on <a class=link href=https://github.com/sqlcollaborative/dbachecks target=_blank rel=noopener>GitHub</a> which means you can fork and contribute to it just as you would with any other open source project. There is also a lot of useful information out there including the <a class=link href=https://github.com/sqlcollaborative/dbachecks#dbachecks target=_blank rel=noopener>readme</a>.Â  Reviewing this readme is an important first step as there are a couple of prerequisites and some potential caveats when you go to update the module.</p><p>You can download a copy of the module from the PowerShell GalleryÂ (if this doesn&rsquo;t work for you due to corporate firewalls, PowerShell version etc. head back to the readme for more ways to get the module):</p><p>Install-Module dbachecks</p><p>First off let&rsquo;s take a look at <em>Get-DbcCheck</em> to look for checks we may want to implement: <img src=/images/Get-DbCCheck.jpg loading=lazy></p><p>Each check has one unique tag which basically names the check and then a number of other tags that can also be used to call a collection of checks.</p><p>For this example we are going to use several checks to ensure that we meet the following requirements:</p><ul><li>Full backup once a week - using <em>LastFullBackup</em></li><li>Differential backup once a day - using <em>LastDiffBackup</em></li><li>Log backup every hour - using <em>LastLogBackup</em></li></ul><p>Since each of the three checks we want to run also have the <em>LastBackup</em> tag we can use that to call the collection of checks at once.</p><p>There are many ways to point dbachecks at your instances, for this simple example we&rsquo;ll just pass in one server name to check.</p><p>$server = &ldquo;ServerName&rdquo;
Invoke-DbcCheck -SqlInstance $server -Check LastBackup</p><p><img src=/images/ChecksFailing.jpg loading=lazy></p><p>As you can clearly see from the test results there is a lot of red, meaning I&rsquo;m not meeting backup requirements. However looking closer at the context we can see that the check is not configured for my specific needs &ldquo;StackOverflow full backups on Server should be less than 1 days&rdquo;, but I only require a full backup within 7 days.</p><p>The checks are set up in a way that make them extremely flexible. You can configure them to meet your needs exactly. We can use <em>Get-DbcConfig</em> to review the backup configurations.Â  Here you can see we&rsquo;re looking for full backups every 1 day (policy.backup.fullmaxdays), differentials every 25 hours (policy.backup.diffmaxhours) and log backups every 15 minutes (policy.backup.logmaxminutes).</p><p><img src=/images/Get-DbcConfig.jpg loading=lazy></p><p>Let&rsquo;s change these configuration properties to match our requirements of a full backup within the last 7 days and a log backup in the last 60 minutes.</p><p>Set-DbcConfig -Name policy.backup.fullmaxdays -Value 7
Set-DbcConfig -Name policy.backup.logmaxminutes -Value 60</p><p>Now that the configuration is setup correctly we can rerun and confirm our environment backups are in the green.</p><p><img src=/images/ChecksSuccess.jpg loading=lazy></p><p>Validating your backups are running is just one small example of how you can utilize dbachecks to keep your environment in line.Â  In fact this is just the tip of the iceberg, there are 80 checks as of writing this post as well as multiple ways to display the results (including a pretty impressive PowerBi dashboard -Â <a class=link href=http://claudioessilva.eu/2018/02/22/dbachecks-using-power-bi-dashboards-to-analyse-results/ target=_blank rel=noopener>ClÃ¡udio Silva has a great post on that</a>).</p><p>I hope this has peaked your interest in dbachecks, I suggest heading over to the <a class=link href=https://github.com/sqlcollaborative/dbachecks#dbachecks target=_blank rel=noopener>readme</a> to learn more or download a copy and get checking right away!</p><p>Useful links:</p><ul><li><a class=link href=https://github.com/sqlcollaborative/dbachecks target=_blank rel=noopener>dbachecks on github</a></li><li><a class=link href=http://dbachecks.io/blog target=_blank rel=noopener>dbachecks blog</a></li><li><a class=link href=https://dbachecks.io/introducing target=_blank rel=noopener>Introducing dbachecks</a>Â - including links to a plethora of blog posts by other contributors</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/dbachecks/>dbachecks</a>
<a href=/tags/powershell/>powershell</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/dbachecks-and-azure-sql-databases/><div class=article-details><h2 class=article-title>dbachecks and Azure SQL Databases</h2></div></a></article><article><a href=/t-sql-tuesday-#135-the-outstanding-tools-of-the-trade-that-make-your-job-awesome/><div class=article-details><h2 class=article-title>T-SQL Tuesday #135: The outstanding tools of the trade that make your job awesome</h2></div></a></article><article><a href=/t-sql-tuesday-#130-automate-your-stress-away/><div class=article-details><h2 class=article-title>T-SQL Tuesday #130 â€“ Automate Your Stress Away</h2></div></a></article><article><a href=/dbachecks-meets-importexcel/><div class=article-details><h2 class=article-title>dbachecks meets ImportExcel</h2></div></a></article><article class=has-image><a href=/ad-powershell-domain/><div class=article-image><img src=/ad-powershell-domain/cover.1f6e3c7a515e11da6cb002af63610e16_hu13e3ae6f863033d0af17372d9ca75135_471265_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post Run ActiveDirectory PowerShell commands against another domain" data-key=ad-powershell-domain data-hash="md5-H248elFeEdpssAKvY2EOFg=="></div><div class=article-details><h2 class=article-title>Run ActiveDirectory PowerShell commands against another domain</h2></div></a></article></div></div></aside><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2018 -
2022 Jess Pomfret</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.15.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>