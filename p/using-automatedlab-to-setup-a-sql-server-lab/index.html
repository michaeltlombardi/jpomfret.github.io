<!doctype html><html lang=en-gb dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Iâ€™ve recently found myself in a few situations where Iâ€™ve needed a certain lab setup to test something.Â Most scenarios these days I find myself firing up some docker containers to run demos or tests against. However, there are a few circumstances where you may need a little more than that, perhaps to test something Windows OS related (my container setup is using Linux) or just to replicate a production environment more closely than you can with containers."><title>Using AutomatedLab to setup a SQL Server Lab</title><link rel=canonical href=https://jpomfret.github.io/p/using-automatedlab-to-setup-a-sql-server-lab/><link rel=stylesheet href=/scss/style.min.3b122f5b6a7023e613be9affad843eaceacf4a3383edd177ce41e35501998968.css><meta property="og:title" content="Using AutomatedLab to setup a SQL Server Lab"><meta property="og:description" content="Iâ€™ve recently found myself in a few situations where Iâ€™ve needed a certain lab setup to test something.Â Most scenarios these days I find myself firing up some docker containers to run demos or tests against. However, there are a few circumstances where you may need a little more than that, perhaps to test something Windows OS related (my container setup is using Linux) or just to replicate a production environment more closely than you can with containers."><meta property="og:url" content="https://jpomfret.github.io/p/using-automatedlab-to-setup-a-sql-server-lab/"><meta property="og:site_name" content="Jess Pomfret"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="automatedlab"><meta property="article:tag" content="powershell"><meta property="article:published_time" content="2020-03-03T00:00:00+00:00"><meta property="article:modified_time" content="2020-03-03T00:00:00+00:00"><meta name=twitter:site content="@jpomfret"><meta name=twitter:creator content="@jpomfret"><meta name=twitter:title content="Using AutomatedLab to setup a SQL Server Lab"><meta name=twitter:description content="Iâ€™ve recently found myself in a few situations where Iâ€™ve needed a certain lab setup to test something.Â Most scenarios these days I find myself firing up some docker containers to run demos or tests against. However, there are a few circumstances where you may need a little more than that, perhaps to test something Windows OS related (my container setup is using Linux) or just to replicate a production environment more closely than you can with containers."></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hue9d3f1fdfff07cb5f7aa0c4e4da11a16_12179_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ðŸ¦„</span></figure><div class=site-meta><h1 class=site-name><a href=/>Jess Pomfret</a></h1><h2 class=site-description>Database Engineer with a Passion for Automation</h2></div></header><ol class=menu id=main-menu><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#step-1-get-the-module><strong>Step 1: Get the module</strong></a></li><li><a href=#step-2-stage-the-isos><strong>Step 2: Stage the ISOs</strong></a></li><li><a href=#step-3-craft-the-lab-setup-script><strong>Step 3: Craft the lab setup script</strong></a></li><li><a href=#step-4-install-the-lab><strong>Step 4: Install the lab</strong></a></li><li><a href=#step-5-use-the-lab><strong>Step 5: Use the lab</strong></a></li><li><a href=#remove-the-lab><strong>Remove the lab</strong></a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/automated-lab/>automated-lab</a>
<a href=/categories/powershell/>powershell</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/using-automatedlab-to-setup-a-sql-server-lab/>Using AutomatedLab to setup a SQL Server Lab</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Mar 03, 2020</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>Iâ€™ve recently found myself in a few situations where Iâ€™ve needed a certain lab setup to test something.Â  Most scenarios these days I find myself firing up some docker containers to run demos or tests against. However, there are a few circumstances where you may need a little more than that, perhaps to test something Windows OS related (my container setup is using Linux) or just to replicate a production environment more closely than you can with containers.Â  In these situations I turn to PowerShell.</p><p>There is a fantastic PowerShell module called <a class=link href=https://github.com/AutomatedLab/AutomatedLab target=_blank rel=noopener>AutomatedLab</a> that can enable you to easily build out a lab for theÂ  specific scenario you need to test. Even better is the module comes with 70 sample scripts that you can start with and adapt to meet your needs.</p><p>The module gives you the option to work with Hyper-V or VMWare. I will say most of the examples are using Hyper-V, and that is what Iâ€™ll be using also.</p><p>For my lab I want a SQL Server 2019 instance joined to a domain, and a separate client machine that I can manage the SQL Server from. On the client I would need to be able to connect to the internet as I want to be able to download PowerShell modules from the gallery easily.</p><h2 id=step-1-get-the-module><strong>Step 1: Get the module</strong></h2><p>There is some setup involved to make sure the pieces needed to build your lab are in the right places.Â  AutomatedLab gives you two options to ensure youâ€™re set up correctly. <a class=link href=https://github.com/AutomatedLab/AutomatedLab/wiki/1.-Installation target=_blank rel=noopener>The documentation on GitHub</a> already does a great job of outlining these so Iâ€™ll just point you in that direction for reference.</p><p>In my lab I used the second method to download from the PowerShell Gallery and then run the configuration command. I ran the following to get my laptop setup:</p><p>Install-Module -Name AutomatedLab -AllowClobber
New-LabSourcesFolder</p><h2 id=step-2-stage-the-isos><strong>Step 2: Stage the ISOs</strong></h2><p>In order to build our lab we will need to store the ISOs needed for installation where AutomatedLab can access them. We used the defaults during our install so that location is <code>C:\LabSources\ISOs</code>.Â  You can see below Iâ€™ve placed the ISOs for Windows Server 2019, SQL Server 2016 and SQL Server 2019 in this folder.</p><p><img src="https://i1.wp.com/jesspomfret.com/wp-content/uploads/2020/02/isos.jpg?fit=650%2C112&ssl=1" loading=lazy alt="iso folder"></p><p>You can test whether AutomatedLab can see the operating system ISOs by using the <code>Get-AvailableOperatingSystems</code> command. You can see below it has found my ISO folder and therefore lists the available operating systems that I can use. Youâ€™ll notice that the Windows Server 2019 ISO allows me to install two editions, Standard or Datacenter, as well as choosing between installing the core version or the more traditional desktop experience.Â </p><p>It is important to ensure you have the appropriate licensing in place for the OS you install. You can use evaluation editions or enter product keys at a later time.</p><p><img src="https://i2.wp.com/jesspomfret.com/wp-content/uploads/2020/02/AvailableOS.jpg?fit=650%2C79&ssl=1" loading=lazy alt="available isos"></p><h2 id=step-3-craft-the-lab-setup-script><strong>Step 3: Craft the lab setup script</strong></h2><p>Now this sounds like a scary step, but fear not! I mentioned before the AutomatedLab team have included over 70 sample scripts, which means itâ€™s likely there is something similar already written. I found that there were two samples that covered all the parts needed for my lab, so I was able to combine them to create the exact scenario needed.</p><p>Iâ€™ve added comments throughout the script below so you can easily see the pieces needed:</p><p><a class=link href=https://gist.github.com/jpomfret/15dd515bfd421ae13c047f95d65eb333 target=_blank rel=noopener>https://gist.github.com/jpomfret/15dd515bfd421ae13c047f95d65eb333</a></p><p>By default, if you donâ€™t specify a the <code>-VmPath</code> parameter on the <code>New-LabDefinition</code> function AutomatedLab will test the speed of the available drives and choose the fastest.</p><h2 id=step-4-install-the-lab><strong>Step 4: Install the lab</strong></h2><p>With the script written, open the PowerShell console using â€˜Run as Administratorâ€™ and execute the script.Â </p><p>.\AutomatedLab_SQLServer.ps1</p><p>There will also be some security settings to consider and accept for the first install such as enabling WinRM and adding â€˜*â€™ to your TrustedHosts. Once those are confirmed and the prework is complete, a toast will pop up showing that the lab has started building:</p><p><img src=/images/StartToast.jpg loading=lazy alt="lab started toast"></p><p>This is the perfect time to grab a cup of coffee as there are some steps that can take a while, especially if this is the first install.</p><p>AutomatedLab uses a base disk for installations of the same OS. Creating this base disk can take a while but once it is created it significantly reduces the amount of disk space you need for your lab. If you deploy 4 VMs with the same OS, as I have here, the base disk will be created and then differential disks can be used for each VM.</p><p>If you build a second lab in the same VM folder with the same OS it can again reuse this base disk.</p><h2 id=step-5-use-the-lab><strong>Step 5: Use the lab</strong></h2><p>Once the install is complete, another toast will appear and itâ€™s time to log in and start using your lab.</p><p><img src=/images/completetoast.jpg loading=lazy alt="lab finished toast"></p><p>The summary we displayed using <code>Show-LabDeploymentSummary</code> will show the machine names, administrator password and some other connection information. We have again used the defaults for these settings but they can be overwritten.</p><h2 id=remove-the-lab><strong>Remove the lab</strong></h2><p>Once you are done with your lab you can quickly and easily run the following to destroy all the pieces created by your lab (except the base OS disk).</p><p>Remove-Lab SQLLab</p></section><footer class=article-footer><section class=article-tags><a href=/tags/automatedlab/>automatedlab</a>
<a href=/tags/powershell/>powershell</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/run-activedirectory-powershell-commands-against-another-domain/><div class=article-image><img src=/cover.jpg loading=lazy data-key data-hash=/cover.jpg></div><div class=article-details><h2 class=article-title>Run ActiveDirectory PowerShell commands against another domain</h2></div></a></article><article class=has-image><a href=/p/log-ship-staged/><div class=article-image><img src=/cover.jpg loading=lazy data-key=log-ship-staged data-hash=/cover.jpg></div><div class=article-details><h2 class=article-title>Log Shipping â€“ Pre-stage database backups with dbatools</h2></div></a></article><article><a href=/p/collating-index-usage-stats-across-availability-group-replicas/><div class=article-details><h2 class=article-title>Collating index usage stats across Availability Group replicas</h2></div></a></article><article><a href=/p/t-sql-tuesday-#143-short-code-examples/><div class=article-details><h2 class=article-title>T-SQL Tuesday #143: Short code examples</h2></div></a></article><article><a href=/p/searching-stored-procedures-for-a-pattern-made-easy-with-dbatools/><div class=article-details><h2 class=article-title>Searching Stored Procedures for a pattern made easy with dbatools</h2></div></a></article></div></div></aside><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2022 Jess Pomfret</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.15.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>