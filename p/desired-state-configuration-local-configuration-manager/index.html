<!doctype html><html lang=en-gb dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Once we have crafted the perfect configuration and shipped it out to our target nodes, it‚Äôs time for the magic to happen. The MOF file that we created by executing our configuration is translated and enacted by the Local Configuration Manager (LCM) on each target node. The LCM is the engine of DSC and plays a vital role in managing our target nodes.
The LCM on each target node has many settings that can be configured using a meta configuration."><title>Desired State Configuration: Local Configuration Manager</title><link rel=canonical href=https://jpomfret.github.io/p/desired-state-configuration-local-configuration-manager/><link rel=stylesheet href=/scss/style.min.3b122f5b6a7023e613be9affad843eaceacf4a3383edd177ce41e35501998968.css><meta property="og:title" content="Desired State Configuration: Local Configuration Manager"><meta property="og:description" content="Once we have crafted the perfect configuration and shipped it out to our target nodes, it‚Äôs time for the magic to happen. The MOF file that we created by executing our configuration is translated and enacted by the Local Configuration Manager (LCM) on each target node. The LCM is the engine of DSC and plays a vital role in managing our target nodes.
The LCM on each target node has many settings that can be configured using a meta configuration."><meta property="og:url" content="https://jpomfret.github.io/p/desired-state-configuration-local-configuration-manager/"><meta property="og:site_name" content="Jess Pomfret"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="desired-state-configuration"><meta property="article:tag" content="dsc"><meta property="article:tag" content="lcm"><meta property="article:tag" content="local-configuration-manager"><meta property="article:tag" content="powershell"><meta property="article:published_time" content="2019-03-25T00:00:00+00:00"><meta property="article:modified_time" content="2019-03-25T00:00:00+00:00"><meta name=twitter:site content="@jpomfret"><meta name=twitter:creator content="@jpomfret"><meta name=twitter:title content="Desired State Configuration: Local Configuration Manager"><meta name=twitter:description content="Once we have crafted the perfect configuration and shipped it out to our target nodes, it‚Äôs time for the magic to happen. The MOF file that we created by executing our configuration is translated and enacted by the Local Configuration Manager (LCM) on each target node. The LCM is the engine of DSC and plays a vital role in managing our target nodes.
The LCM on each target node has many settings that can be configured using a meta configuration."></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hue9d3f1fdfff07cb5f7aa0c4e4da11a16_12179_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ü¶Ñ</span></figure><div class=site-meta><h1 class=site-name><a href=/>Jess Pomfret</a></h1><h2 class=site-description>Database Engineer with a Passion for Automation</h2></div></header><ol class=menu id=main-menu><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#important-lcm-settings><strong>Important LCM Settings</strong></a></li><li><a href=#configure-the-lcm>Configure the LCM</a></li><li><a href=#applyandautocorrect>ApplyAndAutoCorrect</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/dsc/>dsc</a>
<a href=/categories/powershell/>powershell</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/desired-state-configuration-local-configuration-manager/>Desired State Configuration: Local Configuration Manager</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Mar 25, 2019</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>3 minute read</time></div></footer></div></header><section class=article-content><p>Once we have crafted the perfect configuration and shipped it out to our target nodes, it‚Äôs time for the magic to happen. The <a class=link href=https://jesspomfret.com/dsc-mof-files/ target=_blank rel=noopener>MOF file that we created</a> by executing our configuration is translated and enacted by the Local Configuration Manager (LCM) on each target node. The LCM is the engine of DSC and plays a vital role in managing our target nodes.</p><p>The LCM on each target node has many settings that can be configured using a meta configuration. This document is written very similarly to our regular DSC configurations and then pushed out to the target node. ¬†I‚Äôm going to cover a few of the important LCM settings for use in <code>push</code> mode. This is where the LCM passively waits for a MOF file to arrive. The other option is <code>pull</code> mode- this is a little more complicated to set up and in this scenario the LCM is set to actively check in with a pull server for new configurations.</p><h3 id=important-lcm-settings><strong>Important LCM Settings</strong></h3><p>As mentioned we are going to look at a subset of LCM settings. A full list is available at books online ‚Äú<a class=link href=https://docs.microsoft.com/en-us/powershell/dsc/managing-nodes/metaconfig target=_blank rel=noopener>Configuring the Local Configuration Manager</a>‚Äù.</p><p>[table id=6 /]</p><h3 id=configure-the-lcm>Configure the LCM</h3><p>We are going to change a couple of the LCM settings by writing a meta configuration document, compiling it as a MOF and pushing it to our target node. The LCM on that target node will receive this MOF file and enact it to put the LCM into the desired state. To start with we can check out the available settings by using the <code>Get-DscLocalConfigurationManager</code> cmdlet.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Get-DscLocalConfigurationManager -CimSession dscsvr2
</span></span></code></pre></td></tr></table></div></div><p><img src=/images/get_before.jpg loading=lazy></p><p>We are going to change two settings in this example. First, I‚Äôm going to change the ConfigurationModeFrequencyMins to 20 minutes, instead of the default of 15. ¬†Secondly, I will change the RebootNodeIfNeeded to true. This means if I push out a configuration that requires a reboot my node will automatically reboot.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[DSCLocalConfigurationManager()]
</span></span><span class=line><span class=cl>configuration LCMConfig
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    Node dscsvr2
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        Settings
</span></span><span class=line><span class=cl>        {
</span></span><span class=line><span class=cl>           ConfigurationModeFrequencyMins = 20
</span></span><span class=line><span class=cl>           RebootNodeIfNeeded = $true
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>I‚Äôll then execute the <code>LCMConfig</code> configuration to generate a meta MOF file. You can see this is named with the target node name and then the extension is <code>.meta.mof</code>. For a regular configuration the file would just be named with the target node name and the extension of just <code>.mof</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>LCMConfig -Output .\output\
</span></span></code></pre></td></tr></table></div></div><p><img src=/images/CreateMetaMof.jpg loading=lazy></p><p>We will then enact this configuration using <code>Set-DscLocalConfigurationManager</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Set-DscLocalConfigurationManager -Path .\output\ -ComputerName dscsvr2 -Verbose
</span></span></code></pre></td></tr></table></div></div><p><img src=/images/set-DscLcm-1024x239.jpg loading=lazy></p><p>Once this is complete we can check our settings using the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Get-DscLocalConfigurationManager -CimSession dscsvr2  |
</span></span><span class=line><span class=cl>Select-Object ConfigurationModeFrequencyMins, RebootNodeIfNeeded
</span></span></code></pre></td></tr></table></div></div><p><img src=/images/get_after-1024x107.jpg loading=lazy></p><p>Now our LCM is in our defined desired state and we are ready to push out a configuration to set the desired state of our server.</p><h3 id=applyandautocorrect>ApplyAndAutoCorrect</h3><p>The LCM can also play an important role in keeping our servers in the desired state. If we changed the <code>ConfigurationMode</code> to <code>ApplyAndAutoCorrect</code> the LCM would check every 15 minutes (default value for <code>ConfigurationModeFrequencyMins</code>) to ensure the server was still in the desired state. If it found it was not, the LCM would reenact the current MOF to put the server back to desired state. This is a pretty powerful feature but one that definitely requires some thought. I can imagine a 3rd party vendor wouldn‚Äôt be too happy if they set something on installation and my DSC configuration reverted that automatically.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/desired-state-configuration/>desired-state-configuration</a>
<a href=/tags/dsc/>dsc</a>
<a href=/tags/lcm/>lcm</a>
<a href=/tags/local-configuration-manager/>local-configuration-manager</a>
<a href=/tags/powershell/>powershell</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/desired-state-configuration-a-few-warnings-when-using-psdscrunascredentials/><div class=article-details><h2 class=article-title>Desired State Configuration: A few warnings when using PSDscRunAsCredentials</h2></div></a></article><article><a href=/p/desired-state-configuration-troubleshooting-in-push-refresh-mode/><div class=article-details><h2 class=article-title>Desired State Configuration: Troubleshooting in Push Refresh Mode</h2></div></a></article><article><a href=/p/desired-state-configuration-mof-files/><div class=article-details><h2 class=article-title>Desired State Configuration: MOF Files</h2></div></a></article><article><a href=/p/introduction-to-desired-state-configuration/><div class=article-details><h2 class=article-title>Introduction to Desired State Configuration</h2></div></a></article><article><a href=/p/desired-state-configuration-resources/><div class=article-details><h2 class=article-title>Desired State Configuration: Resources</h2></div></a></article></div></div></aside><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2022 Jess Pomfret</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.15.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>