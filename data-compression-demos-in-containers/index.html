<!doctype html><html lang=en-gb dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="One of the things I want to spend more time exploring this year is containers, specifically SQL Server running in containers. While Iâ€™ve been preparing to give my data compression talk at SQL Saturday Cleveland, which is only two weeks away, and generally procrastinating from all other responsibilities, I decided I should change my demos from running against a VM on my laptop to running against a containerized instance of SQL Server."><title>Data Compression Demos in Containers</title><link rel=canonical href=https://jpomfret.github.io/data-compression-demos-in-containers/><link rel=stylesheet href=/scss/style.min.3b122f5b6a7023e613be9affad843eaceacf4a3383edd177ce41e35501998968.css><meta property="og:title" content="Data Compression Demos in Containers"><meta property="og:description" content="One of the things I want to spend more time exploring this year is containers, specifically SQL Server running in containers. While Iâ€™ve been preparing to give my data compression talk at SQL Saturday Cleveland, which is only two weeks away, and generally procrastinating from all other responsibilities, I decided I should change my demos from running against a VM on my laptop to running against a containerized instance of SQL Server."><meta property="og:url" content="https://jpomfret.github.io/data-compression-demos-in-containers/"><meta property="og:site_name" content="Jess Pomfret"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="containers"><meta property="article:tag" content="data-compression"><meta property="article:published_time" content="2019-01-23T00:00:00+00:00"><meta property="article:modified_time" content="2019-01-23T00:00:00+00:00"><meta name=twitter:site content="@jpomfret"><meta name=twitter:creator content="@jpomfret"><meta name=twitter:title content="Data Compression Demos in Containers"><meta name=twitter:description content="One of the things I want to spend more time exploring this year is containers, specifically SQL Server running in containers. While Iâ€™ve been preparing to give my data compression talk at SQL Saturday Cleveland, which is only two weeks away, and generally procrastinating from all other responsibilities, I decided I should change my demos from running against a VM on my laptop to running against a containerized instance of SQL Server."><script async src="https://www.googletagmanager.com/gtag/js?id=G-YL15E7BXXF"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YL15E7BXXF",{anonymize_ip:!1})}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hue9d3f1fdfff07cb5f7aa0c4e4da11a16_12179_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ðŸ¦„</span></figure><div class=site-meta><h1 class=site-name><a href=/>Jess Pomfret</a></h1><h2 class=site-description>Database Engineer with a Passion for Automation</h2></div></header><ol class=menu id=main-menu><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#demo-environment-setup>Demo environment setup</a></li><li><a href=#creating-my-image>Creating my Image</a></li><li><a href=#running-my-demo-container>Running my demo container</a></li><li><a href=#try-it-yourself>Try it yourself</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/data-compression/>data-compression</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/data-compression-demos-in-containers/>Data Compression Demos in Containers</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jan 23, 2019</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>One of the things I want to spend more time exploring this year is containers, specifically SQL Server running in containers. While Iâ€™ve been preparing to give my data compression talk at SQL Saturday Cleveland, which is only two weeks away, and generally procrastinating from all other responsibilities, I decided I should change my demos from running against a VM on my laptop to running against a containerized instance of SQL Server.</p><p>First, a couple of blog shout outs. This idea had been in my mind for a little while after reading <a class=link href=https://www.cathrinewilhelmsen.net/2018/12/02/sql-server-2019-docker-container/ target=_blank rel=noopener>a great post by Cathrine Wilhelmsen</a> where she wrote about moving her demo environments to containers. Iâ€™ve also spent a decent amount of time reading <a class=link href=https://dbafromthecold.com/2017/03/15/summary-of-my-container-series/ target=_blank rel=noopener>Andrew Pruskiâ€™s excellent container series</a>. These were the source for the majority of both my knowledge and confidence that I could pull this off.</p><h3 id=demo-environment-setup>Demo environment setup</h3><p>I use three databases in my data compression demos - first is a copy of AdventureWorks. On my VM I actually removed some of the tables I didnâ€™t use to skinny it down a little. The second database I named â€˜SalesOrderLargeâ€™ and is just three copies of the SalesOrderDetail and SalesOrderHeader tables that have been enlarged using Jonathan Kehayiasâ€™ script. Finally, I have a â€˜CompressTestâ€™ database that is just an empty shell that I use to create one table in during the demos to show the internals of compression.</p><h3 id=creating-my-image>Creating my Image</h3><p>The first step in this process was to stop the SQL Server service in my VM and copy out the database files (mdf & ldf) to use in my container. Iâ€™ll save these into a folder on my laptop for now and then theyâ€™ll be copied into my image as itâ€™s built.</p><p>I created the dockerfile below (following Andrewâ€™s <a class=link href=https://dbafromthecold.com/2018/12/11/attaching-databases-via-a-dockerfile-update/ target=_blank rel=noopener>example</a>) that will be used to build an image for my datacompression containers. This image is based off the SQL Server 2019 CTP 2.2 image from Microsoft, then weâ€™ll create a folder and copy in a script and the files for my three databases. The last line runs the script and starts SQL Server.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># start with the SQL 2019 CTP 2.2 image
</span></span><span class=line><span class=cl>FROM mcr.microsoft.com/mssql/server:2019-CTP2.2-ubuntu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># create a folder and copy in the attach-db script
</span></span><span class=line><span class=cl>RUN mkdir /var/opt/sqlserver
</span></span><span class=line><span class=cl>COPY attach-db.sh /var/opt/sqlserver
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl># copy in AdventureWorks database files
</span></span><span class=line><span class=cl>COPY DatabaseFiles/AdventureWorks2017.mdf /var/opt/sqlserver
</span></span><span class=line><span class=cl>COPY DatabaseFiles/AdventureWorks2017_log.ldf /var/opt/sqlserver
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># copy in CompressTest database files
</span></span><span class=line><span class=cl>COPY DatabaseFiles/CompressTest.mdf /var/opt/sqlserver
</span></span><span class=line><span class=cl>COPY DatabaseFiles/CompressTest_log.ldf /var/opt/sqlserver
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># copy in SalesOrderLarge database files
</span></span><span class=line><span class=cl>COPY DatabaseFiles/SalesOrderLarge.mdf /var/opt/sqlserver
</span></span><span class=line><span class=cl>COPY DatabaseFiles/SalesOrderLarge_log.ldf /var/opt/sqlserver
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># attach databases and start SQL Server
</span></span><span class=line><span class=cl>ENTRYPOINT /var/opt/sqlserver/attach-db.sh &amp; /opt/mssql/bin/sqlservr
</span></span></code></pre></td></tr></table></div></div><p>The attach-db.sh script uses sqlcmd to execute three <code>CREATE DATABASE</code> commands to finish the setup of my environment and I end up with a folder structure as shown below. You donâ€™t have to put the database files in a separate folder, I only did that for neatness.</p><p><img src=/images/fileSetup.jpg loading=lazy></p><p>Everything is setup so Iâ€™m ready to build my image. Iâ€™ll navigate to the DataCompression folder from my PowerShell console and run the <code>docker build</code> command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cd C:\Docker\DataCompression\
</span></span><span class=line><span class=cl>docker build -t datacompression .
</span></span></code></pre></td></tr></table></div></div><p>To check out my new image Iâ€™ll use <code>docker images</code>:</p><p><img src=/images/dockerimages-1024x116.jpg loading=lazy></p><h3 id=running-my-demo-container>Running my demo container</h3><p>I used to have a ResetEnvironment script that I would use to make sure my VM was setup for the start of my demos. This allowed me to run through and practice my demos as many times as I wanted (read, a lot, probably too many). With containers I will just start up a new one, run through my demos, then remove it, easy as that.</p><p>Side note - I will run some activity against the AdventureWorks database once I start the container. This is needed to show the compression suggestions since these are partially based off index usage. Iâ€™ll probably still use some kind of script to start a container and run the load in preparation for the demos.</p><p>For now, Iâ€™ll just use the following to start up a container from my new datacompression image. The important parts of this code are firstly, setting <code>-p 1433:1433</code>, this maps the containers port 1433 to the host computers port. Secondly, we need to set two environmental variables, <code>ACCEPT_EULA=Y</code> to accept the end user licensing agreement and <code>SA_PASSWORD=â€™passwordâ€™</code> to create the SA password for the instance. In this case the password needs to match what I have used in my <code>attach.sh</code> script otherwise when that runs itâ€™ll throw a failed login error and we wonâ€™t have any databases created.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker run -e ACCEPT_EULA=Y -e SA_PASSWORD=$SaPwd -p 1433:1433 -d datacompression
</span></span></code></pre></td></tr></table></div></div><p>My plan is to use this setup for my demos at SQL Saturday Cleveland. Itâ€™s pretty cool that this works exactly the same in my VM running Windows Server 2016 and SQL Server 2016, or in a linux container running SQL Server 2019.</p><h3 id=try-it-yourself>Try it yourself</h3><p>I&rsquo;m going to write a few follow up posts that make use of this container so if you want to follow along or set up your own environment for tinkering you can pull it down from <a class=link href=https://cloud.docker.com/repository/registry-1.docker.io/jpomfret7/datacompression target=_blank rel=noopener>docker hub</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker pull jpomfret7/datacompression:demo
</span></span><span class=line><span class=cl>docker run -e ACCEPT_EULA=Y -e SA_PASSWORD=$SaPwd -p 1433:1433 -d jpomfret7/datacompression:demo
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/containers/>containers</a>
<a href=/tags/data-compression/>data-compression</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/data-compression-internals/><div class=article-details><h2 class=article-title>Data Compression Internals</h2></div></a></article><article><a href=/data-compression--backup-compression-double-compression/><div class=article-details><h2 class=article-title>Data Compression + Backup Compression = Double Compression?</h2></div></a></article><article><a href=/t-sql-tuesday-#104-code-you-cant-live-without/><div class=article-details><h2 class=article-title>T-SQL Tuesday #104 â€“ Code you can't live without</h2></div></a></article></div></div></aside><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2018 -
2022 Jess Pomfret</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.15.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>