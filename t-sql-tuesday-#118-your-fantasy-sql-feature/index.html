<!doctype html><html lang=en-gb dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This month our T-SQL Tuesday host, Kevin Chant (b|t), has challenged us to propose a new fantasy feature for SQL Server. Firstly, thanks to Kevin for hosting this monthâ€™s blog party.
When I first read the invitation I didnâ€™t have any ideas jump straight into my mind. Since then, Iâ€™ve come up with two. Iâ€™m going to share both since they are for different areasâ€¦ cheating I know ?."><title>T-SQL Tuesday #118 â€“ Your fantasy SQL feature</title><link rel=canonical href=https://jpomfret.github.io/t-sql-tuesday-#118-your-fantasy-sql-feature/><link rel=stylesheet href=/scss/style.min.3b122f5b6a7023e613be9affad843eaceacf4a3383edd177ce41e35501998968.css><meta property="og:title" content="T-SQL Tuesday #118 â€“ Your fantasy SQL feature"><meta property="og:description" content="This month our T-SQL Tuesday host, Kevin Chant (b|t), has challenged us to propose a new fantasy feature for SQL Server. Firstly, thanks to Kevin for hosting this monthâ€™s blog party.
When I first read the invitation I didnâ€™t have any ideas jump straight into my mind. Since then, Iâ€™ve come up with two. Iâ€™m going to share both since they are for different areasâ€¦ cheating I know ?."><meta property="og:url" content="https://jpomfret.github.io/t-sql-tuesday-#118-your-fantasy-sql-feature/"><meta property="og:site_name" content="Jess Pomfret"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="tsqltuesday"><meta property="article:published_time" content="2019-09-10T00:00:00+00:00"><meta property="article:modified_time" content="2019-09-10T00:00:00+00:00"><meta name=twitter:site content="@jpomfret"><meta name=twitter:creator content="@jpomfret"><meta name=twitter:title content="T-SQL Tuesday #118 â€“ Your fantasy SQL feature"><meta name=twitter:description content="This month our T-SQL Tuesday host, Kevin Chant (b|t), has challenged us to propose a new fantasy feature for SQL Server. Firstly, thanks to Kevin for hosting this monthâ€™s blog party.
When I first read the invitation I didnâ€™t have any ideas jump straight into my mind. Since then, Iâ€™ve come up with two. Iâ€™m going to share both since they are for different areasâ€¦ cheating I know ?."><script async src="https://www.googletagmanager.com/gtag/js?id=G-YL15E7BXXF"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YL15E7BXXF",{anonymize_ip:!1})}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hue9d3f1fdfff07cb5f7aa0c4e4da11a16_12179_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ðŸ¦„</span></figure><div class=site-meta><h1 class=site-name><a href=/>Jess Pomfret</a></h1><h2 class=site-description>Database Engineer with a Passion for Automation</h2></div></header><ol class=menu id=main-menu><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#likein-operator>LIKEIN Operator</a></li><li><a href=#agent-alerts--raise-error-when-message-doesnt-contain-text>Agent Alerts â€“ Raise error when message doesnâ€™t contain text</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/t-sql-tuesday/>t-sql-tuesday</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/t-sql-tuesday-#118-your-fantasy-sql-feature/>T-SQL Tuesday #118 â€“ Your fantasy SQL feature</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Sep 10, 2019</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>4 minute read</time></div></footer></div></header><section class=article-content><p><a class=link href=https://www.kevinrchant.com/2019/09/03/t-sql-tuesday-118-your-fantasy-sql-feature/ target=_blank rel=noopener><img src=/images/tsqltues.png loading=lazy></a></p><p>This month our T-SQL Tuesday host, Kevin Chant (<a class=link href=https://www.kevinrchant.com target=_blank rel=noopener>b</a>|<a class=link href=https://twitter.com/kevchant target=_blank rel=noopener>t</a>), has challenged us to propose a new fantasy feature for SQL Server. Firstly, thanks to Kevin for hosting this monthâ€™s blog party.</p><p>When I first read the invitation I didnâ€™t have any ideas jump straight into my mind. Since then, Iâ€™ve come up with two. Iâ€™m going to share both since they are for different areasâ€¦ cheating I know ?.</p><h3 id=likein-operator>LIKEIN Operator</h3><p>First up, I am proposing the introduction of the <code>LIKEIN</code> operator for T-SQL queries. It would be useful to be able to combine the functionality of the <code>LIKE</code> and <code>IN</code> operators. To be able to select multiple strings that include wildcards, without having to use multiple <code>OR</code> clauses would be a great addition to our T-SQL tool belts.</p><p>My example comes from the AdventureWorks2017 database where we need to select the addresses we have listed within two regions. In the United Kingdom postal codes are split into two parts. For example, the postcode for Wembley Stadium is HA9 0WS (Yes, Iâ€™m currently watching the England Vs Bulgaria game). The first half, HA9, is known as the outward code and can be 3 or 4 digits long. This specifies the postcode area and district. The second half of the postcode helps to identify a specific address.Â </p><p>Using my new <code>LIKEIN</code> operator this can easily be accomplished:</p><p>select AddressId, AddressLine1, AddressLine2, City, StateProvinceID, PostalCode
from Person.Address
where PostalCode likein (&lsquo;RG41%&rsquo;, &lsquo;V9B%&rsquo;)</p><p>Since we donâ€™t currently have this functionality Iâ€™ll suggest a few other options.</p><p>First, as mentioned above we could use multiple <code>OR</code> clauses.Â  The main downside to this option is as soon as we add <code>OR</code> into our <code>WHERE</code> clause we lose the ability to do index seeks and instead are forced to scan the entire index.Â  Hopefully with the implementation of <code>LIKEIN</code> we would still be able to use index seeks, as long as the string doesnâ€™t start with a wildcard.</p><p>select AddressId, AddressLine1, AddressLine2, City, StateProvinceID, PostalCode
from Person.Address
where PostalCode like &lsquo;RG41%&rsquo;
or PostalCode like &lsquo;V9B%&rsquo;</p><p>We could also use the <code>substring</code> and <code>charindex</code> functions to match just the first part of <code>PostalCode</code>, before the space with our two desired areas. This also removes our ability to use index seeks. Anytime you add a function onto the right side of the <code>WHERE</code> clause you are forced to scan the whole index or table.</p><p>select AddressId, AddressLine1, AddressLine2, City, StateProvinceID, PostalCode
from Person.Address
where substring(PostalCode,0,charindex(&rsquo; &lsquo;,PostalCode,0)) in(&lsquo;RG41&rsquo;,&lsquo;V9B&rsquo;)</p><p>Finally, hereâ€™s an option that allows us to effectively use our index. We could use two separate queries and combine them with <code>UNION ALL</code>. This results in two seeks and then a concatenation operator in the execution plan to combine the results.Â  Also, since these result sets are not overlapping, <code>UNION ALL</code> can be used instead of <code>UNION</code> since we wonâ€™t have duplicate results to remove.</p><p>select AddressId, AddressLine1, AddressLine2, City, StateProvinceID, PostalCode
from Person.Address
where PostalCode like &lsquo;RG41%&rsquo;
UNION ALL
select AddressId, AddressLine1, AddressLine2, City, StateProvinceID, PostalCode
from Person.Address
where PostalCode like &lsquo;V9B%&rsquo;</p><h3 id=agent-alerts--raise-error-when-message-doesnt-contain-text>Agent Alerts â€“ Raise error when message doesnâ€™t contain text</h3><p>My second new feature is a lot simpler. When configuring SQL Server alerts you have the option to only raise the alert if the message contains certain text. My proposed feature is the opposite- donâ€™t raise the alert if it contains certain text.</p><p>A severity 20 alert, such as the one below contains the client IP address. It would be really nice to exclude any alerts that contained a certain misbehaving client IP, to help keep the noise down.</p><p>Error: 17836, Severity: 20, State: 17.
Length specified in network packet payload did not match number of bytes read;
the connection has been closed. Please contact the vendor of the client library.
[CLIENT: xx.xx.xx.xx]</p><p><img src=/images/tsql117.jpg loading=lazy></p><p>Thanks for reading my fantasy features. Iâ€™m looking forward to reading all the other new ideas out there.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/tsqltuesday/>tsqltuesday</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/t-sql-tuesday-#141-work/life-balance/><div class=article-details><h2 class=article-title>T-SQL Tuesday #141: Work/Life balance</h2></div></a></article><article><a href=/t-sql-tuesday-#135-the-outstanding-tools-of-the-trade-that-make-your-job-awesome/><div class=article-details><h2 class=article-title>T-SQL Tuesday #135: The outstanding tools of the trade that make your job awesome</h2></div></a></article><article><a href=/t-sql-tuesday-#130-automate-your-stress-away/><div class=article-details><h2 class=article-title>T-SQL Tuesday #130 â€“ Automate Your Stress Away</h2></div></a></article><article><a href=/t-sql-tuesday-#127-non-sql-tips-tricks/><div class=article-details><h2 class=article-title>T-SQL Tuesday #127 â€“ Non SQL Tips & Tricks</h2></div></a></article><article><a href=/t-sql-tuesday-#125-unit-testing-databases/><div class=article-details><h2 class=article-title>T-SQL Tuesday â€“ #125: Unit Testing Databases</h2></div></a></article></div></div></aside><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2018 -
2022 Jess Pomfret</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.15.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>