<!doctype html><html lang=en-gb dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Iâ€™ve been working on some Azure exams recently, and I personally learn best by fiddling with things.Â The Microsoft learn content is excellent, and Iâ€™d highly recommend that for any of the Azure exams Iâ€™ve taken so far.Â However, I also like to build things myself and experiment a little with all the available options.
One of the vital parts of this learning and experimenting needs to be cleaning up after myself."><title>Keeping track of Azure resources with tags â€“ Part 1</title><link rel=canonical href=https://jpomfret.github.io/keeping-track-of-azure-resources-with-tags-part-1/><link rel=stylesheet href=/scss/style.min.3b122f5b6a7023e613be9affad843eaceacf4a3383edd177ce41e35501998968.css><meta property="og:title" content="Keeping track of Azure resources with tags â€“ Part 1"><meta property="og:description" content="Iâ€™ve been working on some Azure exams recently, and I personally learn best by fiddling with things.Â The Microsoft learn content is excellent, and Iâ€™d highly recommend that for any of the Azure exams Iâ€™ve taken so far.Â However, I also like to build things myself and experiment a little with all the available options.
One of the vital parts of this learning and experimenting needs to be cleaning up after myself."><meta property="og:url" content="https://jpomfret.github.io/keeping-track-of-azure-resources-with-tags-part-1/"><meta property="og:site_name" content="Jess Pomfret"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="azure"><meta property="article:tag" content="powershell"><meta property="article:tag" content="tags"><meta property="article:published_time" content="2021-03-16T00:00:00+00:00"><meta property="article:modified_time" content="2021-03-16T00:00:00+00:00"><meta name=twitter:site content="@jpomfret"><meta name=twitter:creator content="@jpomfret"><meta name=twitter:title content="Keeping track of Azure resources with tags â€“ Part 1"><meta name=twitter:description content="Iâ€™ve been working on some Azure exams recently, and I personally learn best by fiddling with things.Â The Microsoft learn content is excellent, and Iâ€™d highly recommend that for any of the Azure exams Iâ€™ve taken so far.Â However, I also like to build things myself and experiment a little with all the available options.
One of the vital parts of this learning and experimenting needs to be cleaning up after myself."></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hue9d3f1fdfff07cb5f7aa0c4e4da11a16_12179_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ðŸ¦„</span></figure><div class=site-meta><h1 class=site-name><a href=/>Jess Pomfret</a></h1><h2 class=site-description>Database Engineer with a Passion for Automation</h2></div></header><ol class=menu id=main-menu><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#find-resources-with-a-certain-tag><strong>Find resources with a certain tag</strong></a></li><li><a href=#resources-created-in-the-last-x-days><strong>Resources created in the last x days</strong></a></li><li><a href=#resources-without-a-tag><strong>Resources without a tag</strong></a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/azure/>azure</a>
<a href=/categories/powershell/>powershell</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/keeping-track-of-azure-resources-with-tags-part-1/>Keeping track of Azure resources with tags â€“ Part 1</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Mar 16, 2021</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>4 minute read</time></div></footer></div></header><section class=article-content><p>Iâ€™ve been working on some Azure exams recently, and I personally learn best by fiddling with things.Â  The <a class=link href=https://docs.microsoft.com/en-us/learn/ target=_blank rel=noopener>Microsoft learn</a> content is excellent, and Iâ€™d highly recommend that for any of the Azure exams Iâ€™ve taken so far.Â  However, I also like to build things myself and experiment a little with all the available options.</p><p>One of the vital parts of this learning and experimenting needs to be cleaning up after myself.Â  We all know the risks of leaving things running in Azure- itâ€™s likely to drain your training budget pretty quickly.Â  To be fair, this is also a good lesson for real world scenarios. Getting used to turning off or scaling down resources based on need is a good way to reduce your Azure spend.</p><p>This brings me to one morning last week. I logged in to the portal and got a pop up that my credit was down to under $5, which is not what I was expecting. I started looking around and wondering what Iâ€™d left running â€“ it isnâ€™t always easy to spot though.</p><p>Luckily, John Martin (<a class=link href=https://jqmartin.info/ target=_blank rel=noopener>b</a>|<a class=link href=https://twitter.com/jqmtweets target=_blank rel=noopener>t</a>) has instilled in me the importance of adding a tag for creation date on all resources, as itâ€™s not tracked automatically. This means we can easily see what we last deployed and what we might have forgotten about.</p><p>In Azure, tags are just key value pairs that can be applied to resources and subscriptions to add metadata. You can use them to organise resources by environment, cost centre, business criticality, and anything else that might be important to your individual situation. There is a limit of 50 tags per resource. If youâ€™re getting close to having 50 tags per resource you might need to rethink your tagging strategy to reduce the complexity.</p><p>You can view tags through the portal either through the dedicated â€˜Tagsâ€™ pane, on each individual resource, or on the â€˜Cost Managementâ€™ area. Here you can view your Azure spend broken down by tags, which can be very useful. You can also view tags using either the Azure CLI or PowerShell. I usually opt for PowerShell, so letâ€™s have a look at how we can view resources with certain tags using the <a class=link href=https://www.powershellgallery.com/packages/Az/ target=_blank rel=noopener>Az module</a>.Â  If you donâ€™t already have the module installed you can run <code>Install-Module az</code> to get started. More details on prerequisites and options available can be found in the <a class=link href="https://docs.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-5.6.0" target=_blank rel=noopener>Install Azure PowerShell with PowerShellGet</a> docs.</p><h2 id=find-resources-with-a-certain-tag><strong>Find resources with a certain tag</strong></h2><p>I already mentioned I add a â€˜dateCreatedâ€™ tag to all resources, but when Iâ€™m playing around in Azure and working through training courses I also add a â€˜trainingâ€™ tag and set the value to â€˜trueâ€™.Â  This is an easy way for me to find all the resources Iâ€™ve created while training and clean them up.</p><p>We can easily list these resources in PowerShell using the following one liner:</p><p>Get-AzResource -TagName training -TagValue &rsquo;true&rsquo; |
Select-Object Name, ResourceGroupName,ResourceType, Tags</p><p><img src=/images/trainingTrue-1024x198.jpg loading=lazy alt="results of Get-AzResource"></p><p>If weâ€™re ready to clean them up we can pipe the results from <code>Get-AzResource</code> straight into <code>Remove-AzResource</code>, ensuring we havenâ€™t got anything left running and costing us credit.</p><p>Get-AzResource -TagName training -TagValue &rsquo;true&rsquo; | Remove-AzResource</p><h2 id=resources-created-in-the-last-x-days><strong>Resources created in the last x days</strong></h2><p>Another useful snippet since weâ€™re adding â€˜dateCreatedâ€™ tags to all our resources is to get any resources that have been created in the last few days. Since I have formatted my dates as yyyy-MM-dd in my tags I can easily convert them into dates with PowerShell and then filter based on them.</p><p>Get-AzResource -TagName dateCreated |
Select-Object Name, ResourceType, @{l=&lsquo;dateCreated&rsquo;;e={get-date($_.Tags[&lsquo;dateCreated&rsquo;])}} |
Where-Object dateCreated -gt (get-date).AddDays(-7)</p><p><img src=/images/resourcesCreatedinLastXDays-1024x327.jpg loading=lazy alt="List of resources created in last 7 days in PowerShell"></p><h2 id=resources-without-a-tag><strong>Resources without a tag</strong></h2><p>The final tag related snippets I have for today is to make sure all our resources have the &lsquo;dateCreated&rsquo; tag. Since currently Iâ€™m manually adding these tags there is a chance I forget or get lazy and some resources make it through without the tags.</p><p>We can find these tags by interrogating the key values of the tags:</p><p>Get-AzResource | where {$_.tags.Keys -notcontains &lsquo;dateCreated&rsquo;} |
Select-Object Name, ResourceType, Tags</p><p>Once we know which resources are missing tags we can easily update them using <code>Update-AzTag</code>, the operation parameter that controls what should happen if there are existing tags. Merge will ensure we donâ€™t overwrite the current tags.</p><p>$resources = Get-AzResource -ResourceGroupName missingtag |
Where-Object {$_.tags.Keys -notcontains &lsquo;dateCreated&rsquo;}</p><p>Update-AzTag -ResourceId $resources.ResourceId -Tag @{&lsquo;dateCreated&rsquo; = (Get-Date -Format &ldquo;yyyy-MM-dd&rdquo;)} -Operation Merge</p><p>The main problem with this whole idea is we are relying on whoever creates the resources to both remember to create the tag and put the values of the tag in a standard format.Â  Next week weâ€™ll look at a couple of ways to automate this process.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/azure/>azure</a>
<a href=/tags/powershell/>powershell</a>
<a href=/tags/tags/>tags</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/keeping-track-of-azure-resources-with-tags-part-2/><div class=article-details><h2 class=article-title>Keeping track of Azure resources with tags â€“ Part 2</h2></div></a></article><article><a href=/dbachecks-and-azure-sql-databases/><div class=article-details><h2 class=article-title>dbachecks and Azure SQL Databases</h2></div></a></article><article><a href=/keeping-track-of-azure-resources-with-tags-part-3/><div class=article-details><h2 class=article-title>Keeping track of Azure resources with tags â€“ Part 3</h2></div></a></article><article class=has-image><a href=/ad-powershell-domain/><div class=article-image><img src=/ad-powershell-domain/cover.1f6e3c7a515e11da6cb002af63610e16_hu13e3ae6f863033d0af17372d9ca75135_471265_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post Run ActiveDirectory PowerShell commands against another domain" data-key=ad-powershell-domain data-hash="md5-H248elFeEdpssAKvY2EOFg=="></div><div class=article-details><h2 class=article-title>Run ActiveDirectory PowerShell commands against another domain</h2></div></a></article><article class=has-image><a href=/log-ship-staged/><div class=article-image><img src=/log-ship-staged/cover.f4ab6d164035c79e896561924d558d00_hufa84d3a6e624ae2b3ca125fbcc0da73a_679878_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post Log Shipping â€“ Pre-stage database backups with dbatools" data-key=log-ship-staged data-hash="md5-9KttFkA1x56JZWGSTVWNAA=="></div><div class=article-details><h2 class=article-title>Log Shipping â€“ Pre-stage database backups with dbatools</h2></div></a></article></div></div></aside><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2018 -
2022 Jess Pomfret</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.15.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>